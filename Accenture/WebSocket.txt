What is WebSocket?
WebSocket = Full-duplex persistent connection over TCP
â¡ï¸ Real-time communication between client & server
â¡ï¸ No repeated HTTP requests

Use cases
Chat apps
Video calls signaling
Live dashboards
Multiplayer games
Stock updates


Important
ğŸ‘‰ WebSocket is Application layer protocol
ğŸ‘‰ Runs on TCP (Layer 4)

---------------------------------------------------------
| OSI Layer        | Role in WebSocket                  |
| ---------------- | ---------------------------------- |
| 7ï¸âƒ£ Application  | WebSocket protocol (ws://, wss://) |
| 6ï¸âƒ£ Presentation | JSON, Protobuf encoding            |
| 5ï¸âƒ£ Session      | Persistent connection state        |
| 4ï¸âƒ£ Transport    | TCP (reliable delivery)            |
| 3ï¸âƒ£ Network      | IP routing                         |
| 2ï¸âƒ£ Data Link    | Ethernet/WiFi                      |
| 1ï¸âƒ£ Physical     | Hardware                           |



â¬…ï¸In request:
GET /chat HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: abc123
Sec-WebSocket-Version: 13

â¡ï¸In response:
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: xyz456

âœ… After this â†’ HTTP closes
âœ… WebSocket starts

WebSocket Frame (Message) Format

| FIN | Opcode | Mask | Payload Length | Payload Data |

| Field   | Meaning        |
| ------- | -------------- |
| FIN     | Final frame    |
| Opcode  | Text / Binary  |
| Mask    | Client masking |
| Payload | Actual data    |

| Opcode | Type        |
| ------ | ----------- |
| 0x1    | Text (JSON) |
| 0x2    | Binary      |
| 0x8    | Close       |
| 0x9    | Ping        |
| 0xA    | Pong        |


âŒ Common Problems
1. Idle timeout  --> âŒ Load balancer kills connection --> âœ… Fix: ping/pong
2. No sticky sessions --> âŒ Messages lost --> âœ… Fix: session affinity
3. Memory leaks --> âœ… Too many open sockets
4. Mobile network drops --> âœ…Handle reconnect logic


Code Example(Python): 
```
from fastapi import FastAPI, WebSocket

app = FastAPI()

@app.websocket("/ws")
async def ws_endpoint(ws: WebSocket):
    await ws.accept()
    while True:
        data = await ws.receive_text()
        await ws.send_text(f"Echo: {data}")
```

ğŸ” Backpressure handling

ğŸ‘‰ Mechanism to prevent sender overwhelming receiver by slowing data flow when buffers fill.

ğŸ“¦ Binary streaming

ğŸ‘‰ Sending raw binary data (video, audio, files) instead of text for higher performance and lower latency.

ğŸš€ WebTransport (future)

ğŸ‘‰ Next-gen real-time web protocol over QUIC supporting unreliable + multiplexed streams (successor to WebSocket/WebRTC data).

âš¡ QUIC vs WebSocket

ğŸ‘‰ QUIC = transport protocol (UDP-based), while WebSocket = application protocol over TCP.

ğŸ§µ Multiplexing

ğŸ‘‰ Sending multiple logical streams over one connection without opening multiple sockets.

ğŸ§© Sharding connections

ğŸ‘‰ Distributing users across multiple servers to scale and avoid connection limits.